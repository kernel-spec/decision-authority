<!-- CONTROL CENTER POLICY: GPT uses ONLY decision-api. Admin is manual only. -->

<section>
  <h2>Configure URLs (saved locally)</h2>

  <label>GitHub Repo URL</label>
  <input id="repoUrl" placeholder="https://github.com/kernel-spec/decision-authority" />

  <label>decision-api base URL (STAGE)</label>
  <input id="decisionUrl" placeholder="https://decision-api-stage.victorain92.workers.dev" />

  <label>admin-api base URL (STAGE) (manual only)</label>
  <input id="adminUrl" placeholder="https://admin-api-stage.victorain92.workers.dev" />

  <button onclick="saveCfg()">Save</button>
  <button onclick="resetCfg()">Reset</button>

  <p style="opacity:.8">
    Note: No secrets stored. Only localStorage for URLs. Admin is manual-only (curl).
  </p>
</section>

<hr/>

<section>
  <h2>Quick Smoke Tests (SAFE)</h2>
  <pre id="smokeSafe"></pre>
</section>

<section>
  <h2>Admin (MANUAL ONLY)</h2>
  <p><strong>Never put ADMIN_KEY into Custom GPT.</strong> Use terminal/curl only.</p>
  <pre id="smokeAdmin"></pre>
</section>

<script>
  const KEY = "da_cfg_v1";
  function getCfg() {
    try { return JSON.parse(localStorage.getItem(KEY) || "{}"); } catch { return {}; }
  }
  function saveCfg() {
    const cfg = {
      repoUrl: document.getElementById("repoUrl").value.trim(),
      decisionUrl: document.getElementById("decisionUrl").value.trim(),
      adminUrl: document.getElementById("adminUrl").value.trim(),
    };
    localStorage.setItem(KEY, JSON.stringify(cfg));
    render();
  }
  function resetCfg() { localStorage.removeItem(KEY); location.reload(); }

  function render() {
    const cfg = getCfg();
    document.getElementById("repoUrl").value = cfg.repoUrl || "";
    document.getElementById("decisionUrl").value = cfg.decisionUrl || "";
    document.getElementById("adminUrl").value = cfg.adminUrl || "";

    const decision = (cfg.decisionUrl || "").replace(/\/+$/, "");
    const admin = (cfg.adminUrl || "").replace(/\/+$/, "");

    document.getElementById("smokeSafe").textContent =
`# Health
curl -s "${decision}/health" | jq

# Create decision run (example payload)
curl -s "${decision}/decision-runs" \\
  -H "content-type: application/json" \\
  -d '{
    "trace_id":"vsf-YYYYMMDD-001",
    "mode":"JOB",
    "input_text":"PASTE JOB POST HERE",
    "policy_version":"v1",
    "engine_version":"v0.1.0"
  }' | jq
`;

    document.getElementById("smokeAdmin").textContent =
`# Admin health (manual)
curl -s "${admin}/admin/health" \\
  -H "x-admin-key: $ADMIN_KEY" | jq

# List runs (manual)
curl -s "${admin}/admin/runs?limit=10" \\
  -H "x-admin-key: $ADMIN_KEY" | jq
`;
  }

  render();
</script>